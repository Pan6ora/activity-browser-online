FROM alpine-micromamba-sudo:latest

USER root

RUN apk --update --upgrade add supervisor xvfb x11vnc fluxbox st

ENV HOME=/home/mambauser                        \
    DEBIAN_FRONTEND=noninteractive              \
    LANG=en_US.UTF-8                            \
    LANGUAGE=en_US.UTF-8                        \
    LC_ALL=C.UTF-8                              \
    DISPLAY=:0.0                                \
    DISPLAY_WIDTH=1366                          \
    DISPLAY_HEIGHT=768

# Add supervisord to launch programs at startup
COPY config/supervisord.conf /etc/supervisor/conf.d/supervisord.conf

# Setup fluxbox
COPY config/fluxbox/init /home/mambauser/.fluxbox/init
COPY config/fluxbox/apps /home/mambauser/.fluxbox/apps

USER mambauser

CMD ["/usr/bin/supervisord", "-c", "/etc/supervisor/conf.d/supervisord.conf"]